import React, { Suspense, lazy } from 'react';
import { Implementation, Preview, WrapperToggle, Display, TechnologyUsed, Wrapper, Skeleton, PARTITION, Details, Provider, Title } from "@/components/mdx/MDXServerImports"
import { CodeBlock } from "@/components/mdx/MDXClientImports"

{/*
// ------------------------------------------------------------------------------------
    //	The text below is generated from "@/registry/primitives/command-palette/01"
//------------------------------------------------------------------------------------
*/}

<Wrapper>
<Title>Command Palette</Title>
### A suite of components to create a command palette UI, including triggers, items, and loading states.

<WrapperToggle >
<Preview>

export const Primitives_command_palette_01 = lazy(() => import("@registry/packages/primitives/command-palette/01/react_aria-ts/example"));


<Suspense fallback={<Skeleton className="h-60 rounded-lg" />}>
<Display>
<Primitives_command_palette_01 />
</Display>
</Suspense>

</Preview>

<Implementation>

undefined
<CodeBlock>

```default|js|CommandPalette.jsx
"use client";
import { KeyListener, KeyListenerDisplay } from "@registry/packages/primitives/key-listener/01/default-js/KeyListener";
import { Modal } from "@registry/packages/primitives/modals/01/default-js/Modal";
import { useEffect, useRef, useState } from "react";
import { twMerge } from "tailwind-merge";

export function CommandPaletteTrigger({ keys, setActive, className, ...props }) {
  const ref = useRef(null);

  function handleFocus() {
    setActive((prevState) => !prevState);
    ref.current?.blur();
  }

  return (
    <div className="relative text-foreground w-max">
      {keys && (
        <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2.5">
          <KeyListenerDisplay keys={keys} />
          <KeyListener onKeyDown={handleFocus} keys={keys} />
        </div>
      )}
      <input
        type="text"
        className={twMerge(
          " w-80 md:w-[25rem] my-1 text-primary-foreground placeholder:text-secondary-foreground py-2 pr-24 pl-4 rounded-md bg-primary border-[2px] hover:border-outline border-outline-secondary focus:outline-none",
          className,
        )}
        ref={ref}
        onFocus={handleFocus}
        {...props}
      />
    </div>
  );
}

export function CommandPaletteItem({ children, className, ...props }) {
  return (
    <button
      className={twMerge(
        "w-full h-12 px-2 rounded-md flex justify-between items-center text-base focus:outline-none focus:bg-secondary hover:bg-secondary",
        className,
      )}
      data-menu-item
      {...props}
    >
      {children}
    </button>
  );
}

export function CommandPalette({ isOpen, onOpenChange, children, className }) {
  const [active, setActive] = useState(isOpen);

  
  useEffect(() => {
    if (onOpenChange) onOpenChange(active);
  }, [active]);

  useEffect(() => {
    setActive(isOpen);
  }, [isOpen]);

  return (
    <Modal
      className={twMerge("h-[25rem] w-80 md:w-[30rem] p-0", className)}
      isDismissable
      isOpen={active}
      setOpen={setActive}
    >
      {children}
    </Modal>
  );
}

export function CommandPaletteMenu({ children, isLoading, isEmpty, className, ...props }) {
  const menuRef = useRef(null);
  const [menuItems, setMenuItems] = useState([]);

  
  useEffect(() => {
    if (menuRef.current) {
      const menuItemsFound = menuRef.current.querySelectorAll("[data-menu-item]");
      const arr = Array.from(menuItemsFound);

      setMenuItems(arr);
    }
  }, [children, menuRef.current]);

  function moveFocusToNextElement() {
    const currentIndex = menuItems.indexOf(document.activeElement);

    if (currentIndex >= 0 && currentIndex < menuItems.length - 1) {
      menuItems[currentIndex + 1].focus();
    }

    if (currentIndex === -1) menuItems[0].focus();
  }

  function moveFocusToPreviousElement() {
    const currentIndex = menuItems.indexOf(document.activeElement);

    if (currentIndex > 0 && currentIndex <= menuItems.length - 1) {
      menuItems[currentIndex - 1].focus();
    }
  }
  return (
    <div
      className={twMerge("w-full h-[calc(100%-3.25rem)] z-10 p-2 overflow-y-auto scrollbar-x scrollbar-y", className)}
      ref={menuRef}
      {...props}
    >
      <KeyListener onKeyDown={moveFocusToNextElement} keys={["Down"]} />
      <KeyListener onKeyDown={moveFocusToPreviousElement} keys={["Up"]} />
      {isLoading && <CommandPaletteLoading />}
      {isEmpty && <CommandPaletteEmpty />}
      {!isLoading && !isEmpty && children}
    </div>
  );
}

export function CommandPaletteSearchBar({ className, ...props }) {
  return (
    <input
      type="text"
      className={twMerge(
        "my-1 w-full bg-transparent text-foreground py-2 px-4 rounded-md border-none focus:outline-none",
        className,
      )}
      aria-label="Search box"
      {...props}
    />
  );
}

export function CommandPaletteGroup({ heading, children, className }) {
  return (
    <div className={twMerge("w-full flex flex-col", className)}>
      {heading && (
        <div>
          <h1 className="ml-2 mt-4 mb-3 text-sm font-medium underline underline-offset-1">{heading}</h1>
        </div>
      )}
      {children}
    </div>
  );
}

export function CommandPaletteLoading() {
  return (
    <div className="w-full h-full flex flex-col items-center justify-center">
      <div className="text-center text-sm font-medium text-foreground">
        <Icons.loading className="animate-spin w-8 h-8 mx-auto" />
      </div>
    </div>
  );
}

export function CommandPaletteEmpty() {
  return (
    <div className="w-full h-full flex flex-col items-center justify-center">
      <div className="text-center text-sm font-medium text-foreground">No results found</div>
    </div>
  );
}

export function CommandPaletteDivider({ className }) {
  return <div className={twMerge("min-w-full border-[0.5px] border-outline", className)} />;
}

const Icons = {
  loading: (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" {...props}>
      <title>Loading</title>
      <path fill="currentColor" d="M12 3a9 9 0 0 1 9 9h-2a7 7 0 0 0-7-7V3Z" />
    </svg>
  ),
};

```

```default|js|example.jsx
"use client";

import {
  CommandPalette,
  CommandPaletteDivider,
  CommandPaletteGroup,
  CommandPaletteItem,
  CommandPaletteMenu,
  CommandPaletteSearchBar,
  CommandPaletteTrigger,
} from "@registry/packages/primitives/command-palette/01/default-js/CommandPalette";
import { useState } from "react";

export default function CommandPaletteExample() {
  const [active, setActive] = useState(false);
  const [isLoading, setIsLoading] = useState(false);

  function simulateSearch(event) {
    setIsLoading(true);
    setTimeout(() => {
      setIsLoading(false);
    }, 1500);
  }

  return (
    <>
      <CommandPaletteTrigger placeholder="Search" setActive={setActive} keys={["Control", "j"]} />
      <CommandPalette isOpen={active} onOpenChange={(val) => setActive(val)}>
        <CommandPaletteSearchBar placeholder="Search for something" onChange={(e) => simulateSearch(e)} />
        <CommandPaletteDivider />
        <CommandPaletteMenu isLoading={isLoading}>
          {/* This is a sample data. You can add dynamic data here and manage the loading & empty states accordingly */}
          <CommandPaletteItem>View the components</CommandPaletteItem>
          <CommandPaletteItem>View the primitives</CommandPaletteItem>
          <CommandPaletteGroup heading="Connect">
            <CommandPaletteItem>Give us a feedback</CommandPaletteItem>
            <CommandPaletteItem>Contact the creator</CommandPaletteItem>
            <CommandPaletteItem>Talk about us on X</CommandPaletteItem>
            <CommandPaletteItem>Follow us</CommandPaletteItem>
            <CommandPaletteItem>Refer Docs</CommandPaletteItem>
          </CommandPaletteGroup>
        </CommandPaletteMenu>
      </CommandPalette>
    </>
  );
}

```

```default|ts|CommandPalette.tsx
"use client";
import {
  type Key,
  KeyListener,
  KeyListenerDisplay,
} from "@registry/packages/primitives/key-listener/01/default-ts/KeyListener";
import { Modal } from "@registry/packages/primitives/modals/01/default-ts/Modal";
import type { IconProps } from "@registry/utils/types";
import {
  type ButtonHTMLAttributes,
  type DetailedHTMLProps,
  type Dispatch,
  type HTMLAttributes,
  type InputHTMLAttributes,
  type SetStateAction,
  useEffect,
  useRef,
  useState,
} from "react";
import { twMerge } from "tailwind-merge";

export interface CommandPaletteTriggerProps
  extends DetailedHTMLProps<InputHTMLAttributes<HTMLInputElement>, HTMLInputElement> {
  keys?: Key[];
  setActive: Dispatch<SetStateAction<boolean>>;
}

export function CommandPaletteTrigger({ keys, setActive, className, ...props }: CommandPaletteTriggerProps) {
  const ref = useRef<HTMLInputElement>(null);

  function handleFocus() {
    setActive((prevState) => !prevState);
    ref.current?.blur();
  }

  return (
    <div className="relative text-foreground w-max">
      {keys && (
        <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2.5">
          <KeyListenerDisplay keys={keys} />
          <KeyListener onKeyDown={handleFocus} keys={keys} />
        </div>
      )}
      <input
        type="text"
        className={twMerge(
          " w-80 md:w-[25rem] my-1 text-primary-foreground placeholder:text-secondary-foreground py-2 pr-24 pl-4 rounded-md bg-primary border-[2px] hover:border-outline border-outline-secondary focus:outline-none",
          className as string,
        )}
        ref={ref}
        onFocus={handleFocus}
        {...props}
      />
    </div>
  );
}

export interface CommandPaletteItemProps
  extends DetailedHTMLProps<ButtonHTMLAttributes<HTMLButtonElement>, HTMLButtonElement> {}

export function CommandPaletteItem({ children, className, ...props }: CommandPaletteItemProps) {
  return (
    <button
      className={twMerge(
        "w-full h-12 px-2 rounded-md flex justify-between items-center text-base focus:outline-none focus:bg-secondary hover:bg-secondary",
        className as string,
      )}
      data-menu-item
      {...props}
    >
      {children}
    </button>
  );
}

export interface CommandPaletteProps {
  isOpen: boolean;
  onOpenChange?: (val: boolean) => void;
  children: React.ReactNode;
  className?: string;
}

export function CommandPalette({ isOpen, onOpenChange, children, className }: CommandPaletteProps) {
  const [active, setActive] = useState(isOpen);

  
  useEffect(() => {
    if (onOpenChange) onOpenChange(active);
  }, [active]);

  useEffect(() => {
    setActive(isOpen);
  }, [isOpen]);

  return (
    <Modal
      className={twMerge("h-[25rem] w-80 md:w-[30rem] p-0", className as string)}
      isDismissable
      isOpen={active}
      setOpen={setActive}
    >
      {children}
    </Modal>
  );
}

export interface CommandPaletteMenuProps extends DetailedHTMLProps<HTMLAttributes<HTMLDivElement>, HTMLDivElement> {
  children: React.ReactNode;
  isLoading?: boolean;
  isEmpty?: boolean;
  className?: string;
}

export function CommandPaletteMenu({ children, isLoading, isEmpty, className, ...props }: CommandPaletteMenuProps) {
  const menuRef = useRef<HTMLDivElement>(null);
  const [menuItems, setMenuItems] = useState<HTMLElement[]>([]);

  
  useEffect(() => {
    if (menuRef.current) {
      const menuItemsFound = menuRef.current.querySelectorAll("[data-menu-item]") as NodeListOf<HTMLElement>;
      const arr = Array.from(menuItemsFound);

      setMenuItems(arr);
    }
  }, [children, menuRef.current]);

  function moveFocusToNextElement() {
    const currentIndex = menuItems.indexOf(document.activeElement as HTMLElement);

    if (currentIndex >= 0 && currentIndex < menuItems.length - 1) {
      menuItems[currentIndex + 1].focus();
    }

    if (currentIndex === -1) menuItems[0].focus();
  }

  function moveFocusToPreviousElement() {
    const currentIndex = menuItems.indexOf(document.activeElement as HTMLElement);

    if (currentIndex > 0 && currentIndex <= menuItems.length - 1) {
      menuItems[currentIndex - 1].focus();
    }
  }
  return (
    <div
      className={twMerge(
        "w-full h-[calc(100%-3.25rem)] z-10 p-2 overflow-y-auto scrollbar-x scrollbar-y",
        className as string,
      )}
      ref={menuRef}
      {...props}
    >
      <KeyListener onKeyDown={moveFocusToNextElement} keys={["Down"]} />
      <KeyListener onKeyDown={moveFocusToPreviousElement} keys={["Up"]} />
      {isLoading && <CommandPaletteLoading />}
      {isEmpty && <CommandPaletteEmpty />}
      {!isLoading && !isEmpty && children}
    </div>
  );
}

export interface CommandPaletteSearchBarProps
  extends DetailedHTMLProps<InputHTMLAttributes<HTMLInputElement>, HTMLInputElement> {}

export function CommandPaletteSearchBar({ className, ...props }: CommandPaletteSearchBarProps) {
  return (
    <input
      type="text"
      className={twMerge(
        "my-1 w-full bg-transparent text-foreground py-2 px-4 rounded-md border-none focus:outline-none",
        className as string,
      )}
      aria-label="Search box"
      {...props}
    />
  );
}

export interface CommandPaletteGroupProps {
  children: React.ReactNode;
  heading?: string;
  className?: string;
}
export function CommandPaletteGroup({ heading, children, className }: CommandPaletteGroupProps) {
  return (
    <div className={twMerge("w-full flex flex-col", className)}>
      {heading && (
        <div>
          <h1 className="ml-2 mt-4 mb-3 text-sm font-medium underline underline-offset-1">{heading}</h1>
        </div>
      )}
      {children}
    </div>
  );
}

export function CommandPaletteLoading() {
  return (
    <div className="w-full h-full flex flex-col items-center justify-center">
      <div className="text-center text-sm font-medium text-foreground">
        <Icons.loading className="animate-spin w-8 h-8 mx-auto" />
      </div>
    </div>
  );
}

export function CommandPaletteEmpty() {
  return (
    <div className="w-full h-full flex flex-col items-center justify-center">
      <div className="text-center text-sm font-medium text-foreground">No results found</div>
    </div>
  );
}

export function CommandPaletteDivider({ className }: { className?: string }) {
  return <div className={twMerge("min-w-full border-[0.5px] border-outline", className)} />;
}

const Icons = {
  loading: (props: IconProps) => (
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" {...props}>
      <title>Loading</title>
      <path fill="currentColor" d="M12 3a9 9 0 0 1 9 9h-2a7 7 0 0 0-7-7V3Z" />
    </svg>
  ),
};

```

```default|ts|example.tsx
"use client";

import {
  CommandPalette,
  CommandPaletteDivider,
  CommandPaletteGroup,
  CommandPaletteItem,
  CommandPaletteMenu,
  CommandPaletteSearchBar,
  CommandPaletteTrigger,
} from "@registry/packages/primitives/command-palette/01/default-ts/CommandPalette";
import { type ChangeEvent, useState } from "react";

export default function CommandPaletteExample() {
  const [active, setActive] = useState<boolean>(false);
  const [isLoading, setIsLoading] = useState<boolean>(false);

  function simulateSearch(event: ChangeEvent<HTMLInputElement>) {
    setIsLoading(true);
    setTimeout(() => {
      setIsLoading(false);
    }, 1500);
  }

  return (
    <>
      <CommandPaletteTrigger placeholder="Search" setActive={setActive} keys={["Control", "j"]} />
      <CommandPalette isOpen={active} onOpenChange={(val) => setActive(val)}>
        <CommandPaletteSearchBar placeholder="Search for something" onChange={(e) => simulateSearch(e)} />
        <CommandPaletteDivider />
        <CommandPaletteMenu isLoading={isLoading}>
          {/* This is a sample data. You can add dynamic data here and manage the loading & empty states accordingly */}
          <CommandPaletteItem>View the components</CommandPaletteItem>
          <CommandPaletteItem>View the primitives</CommandPaletteItem>
          <CommandPaletteGroup heading="Connect">
            <CommandPaletteItem>Give us a feedback</CommandPaletteItem>
            <CommandPaletteItem>Contact the creator</CommandPaletteItem>
            <CommandPaletteItem>Talk about us on X</CommandPaletteItem>
            <CommandPaletteItem>Follow us</CommandPaletteItem>
            <CommandPaletteItem>Refer Docs</CommandPaletteItem>
          </CommandPaletteGroup>
        </CommandPaletteMenu>
      </CommandPalette>
    </>
  );
}

```

```react_aria|js|CommandPalette.jsx
"use client";
import { KeyListener, KeyListenerDisplay } from "@registry/packages/primitives/key-listener/01/default-ts/KeyListener";
import { Modal, ModalTrigger } from "@registry/packages/primitives/modals/01/react_aria-ts/Modal";
import { useEffect, useRef, useState } from "react";
import { Button, Group, Input, SearchField } from "react-aria-components";
import { twMerge } from "tailwind-merge";

export function CommandPaletteTrigger({ keys, setActive, className, ...props }) {
  const ref = useRef(null);

  function handleFocus() {
    setActive((prevState) => !prevState);
    ref.current?.blur();
  }

  return (
    <div className="relative text-foreground w-max">
      {keys && (
        <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2.5">
          <KeyListenerDisplay keys={keys} />
          <KeyListener onKeyDown={handleFocus} keys={keys} />
        </div>
      )}
      <Input
        type="text"
        className={twMerge(
          " w-80 md:w-[25rem] my-1 text-primary-foreground placeholder:text-secondary-foreground py-2 pr-24 pl-4 rounded-md bg-primary border-[2px] hover:border-outline border-outline-secondary focus:outline-none",
          className,
        )}
        ref={ref}
        onFocus={handleFocus}
        {...props}
      />
    </div>
  );
}

export function CommandPaletteItem({ children, className, ...props }) {
  return (
    <Button
      className={twMerge(
        "w-full h-12 px-2 md:px-4 rounded-md flex justify-between items-center text-base focus:outline-none focus:bg-secondary hover:bg-secondary",
        className,
      )}
      data-menu-item
      {...props}
    >
      {children}
    </Button>
  );
}

export function CommandPalette({ isOpen, onOpenChange, children, className }) {
  return (
    <ModalTrigger isOpen={isOpen} onOpenChange={onOpenChange}>
      <Modal className={twMerge("h-[25rem] w-80 md:w-[30rem] p-0", className)} isDismissable>
        {children}
      </Modal>
    </ModalTrigger>
  );
}

export function CommandPaletteMenu({ children, isLoading, isEmpty, className, ...props }) {
  const menuRef = useRef(null);
  const [menuItems, setMenuItems] = useState([]);

  
  useEffect(() => {
    if (menuRef.current) {
      const menuItemsFound = menuRef.current.querySelectorAll("[data-menu-item]");
      const arr = Array.from(menuItemsFound);
      setMenuItems(arr);
    }
  }, [children, menuRef.current]);

  function moveFocusToNextElement() {
    const currentIndex = menuItems.indexOf(document.activeElement);

    if (currentIndex >= 0 && currentIndex < menuItems.length - 1) {
      menuItems[currentIndex + 1].focus();
    }

    if (currentIndex === -1) menuItems[0].focus();
  }

  function moveFocusToPreviousElement() {
    const currentIndex = menuItems.indexOf(document.activeElement);

    if (currentIndex > 0 && currentIndex <= menuItems.length - 1) {
      menuItems[currentIndex - 1].focus();
    }
  }
  return (
    <Group
      className={twMerge("w-full h-[calc(100%-3.25rem)] z-10 p-2 overflow-y-auto scrollbar-x scrollbar-y", className)}
      ref={menuRef}
      {...props}
    >
      <KeyListener onKeyDown={moveFocusToNextElement} keys={["Down"]} />
      <KeyListener onKeyDown={moveFocusToPreviousElement} keys={["Up"]} />
      {isLoading && <CommandPaletteLoading />}
      {isEmpty && <CommandPaletteEmpty />}
      {!isLoading && !isEmpty && children}
    </Group>
  );
}

export function CommandPaletteSearchBar({ className, ...props }) {
  function handleKeyDown(event) {
    if (event.key === "ArrowDown") {
      const menuItemsFound = document.querySelectorAll("[data-menu-item]");
      const arr = Array.from(menuItemsFound);

      arr[0].focus();
      event.preventDefault();
      arr[0].scrollIntoView({
        behavior: "smooth",
        block: "nearest",
        inline: "nearest",
      });
    }
  }

  return (
    <SearchField aria-label="Search">
      <Input
        type="text"
        className={twMerge(
          "my-1 w-full bg-transparent text-foreground py-2 px-4 rounded-md border-none focus:outline-none",
          className,
        )}
        aria-label="Search box"
        onKeyDown={handleKeyDown}
        autoFocus
        {...props}
      />
    </SearchField>
  );
}

export function CommandPaletteGroup({ heading, children, className }) {
  return (
    <div className={twMerge("w-full flex flex-col", className)}>
      {heading && (
        <div>
          <h1 className="ml-2 mt-4 mb-3 text-sm font-medium underline underline-offset-1">{heading}</h1>
        </div>
      )}
      {children}
    </div>
  );
}

export function CommandPaletteLoading() {
  return (
    <div className="w-full h-full flex flex-col items-center justify-center">
      <div className="text-center text-sm font-medium text-foreground">
        <Icons.loading className="animate-spin w-8 h-8 mx-auto" />
      </div>
    </div>
  );
}

export function CommandPaletteEmpty() {
  return (
    <div className="w-full h-full flex flex-col items-center justify-center">
      <div className="text-center text-sm font-medium text-foreground">No results found</div>
    </div>
  );
}

export function CommandPaletteDivider({ className }) {
  return <div className={twMerge("min-w-full border-[0.5px] border-outline", className)} />;
}

const Icons = {
  loading: (props) => (
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" {...props}>
      <title>Loading</title>
      <path fill="currentColor" d="M12 3a9 9 0 0 1 9 9h-2a7 7 0 0 0-7-7V3Z" />
    </svg>
  ),
};

```

```react_aria|js|example.jsx
"use client";

import {
  CommandPalette,
  CommandPaletteDivider,
  CommandPaletteGroup,
  CommandPaletteItem,
  CommandPaletteMenu,
  CommandPaletteSearchBar,
  CommandPaletteTrigger,
} from "@registry/packages/primitives/command-palette/01/react_aria-js/CommandPalette";
import { useState } from "react";

export default function CommandPaletteExample() {
  const [active, setActive] = useState(false);
  const [isLoading, setIsLoading] = useState(false);

  function simulateSearch(event) {
    setIsLoading(true);
    setTimeout(() => {
      setIsLoading(false);
    }, 1500);
  }

  return (
    <>
      <CommandPaletteTrigger placeholder="Search" setActive={setActive} keys={["Control", "j"]} />
      <CommandPalette isOpen={active} onOpenChange={(val) => setActive(val)}>
        <CommandPaletteSearchBar placeholder="Search for something" onChange={(e) => simulateSearch(e)} />
        <CommandPaletteDivider />
        <CommandPaletteMenu isLoading={isLoading}>
          {/* This is a sample data. You can add dynamic data here and manage the loading & empty states accordingly */}
          <CommandPaletteItem>View the components</CommandPaletteItem>
          <CommandPaletteItem>View the primitives</CommandPaletteItem>
          <CommandPaletteGroup heading="Connect">
            <CommandPaletteItem>Give us a feedback</CommandPaletteItem>
            <CommandPaletteItem>Contact the creator</CommandPaletteItem>
            <CommandPaletteItem>Talk about us on X</CommandPaletteItem>
            <CommandPaletteItem>Follow us</CommandPaletteItem>
            <CommandPaletteItem>Refer Docs</CommandPaletteItem>
          </CommandPaletteGroup>
        </CommandPaletteMenu>
      </CommandPalette>
    </>
  );
}

```

```react_aria|ts|CommandPalette.tsx
"use client";

import {
  type Key,
  KeyListener,
  KeyListenerDisplay,
} from "@registry/packages/primitives/key-listener/01/default-ts/KeyListener";
import { Modal, ModalTrigger } from "@registry/packages/primitives/modals/01/react_aria-ts/Modal";
import type { IconProps } from "@registry/utils/types";
import { type Dispatch, type KeyboardEvent, type SetStateAction, useEffect, useRef, useState } from "react";
import {
  Button,
  type ButtonProps,
  Group,
  type GroupProps,
  Input,
  type InputProps,
  SearchField,
} from "react-aria-components";
import { twMerge } from "tailwind-merge";

export interface CommandPaletteTriggerProps extends InputProps {
  keys?: Key[];
  setActive: Dispatch<SetStateAction<boolean>>;
}

export function CommandPaletteTrigger({ keys, setActive, className, ...props }: CommandPaletteTriggerProps) {
  const ref = useRef<HTMLInputElement>(null);

  function handleFocus() {
    setActive((prevState) => !prevState);
    ref.current?.blur();
  }

  return (
    <div className="relative text-foreground w-max">
      {keys && (
        <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2.5">
          <KeyListenerDisplay keys={keys} />
          <KeyListener onKeyDown={handleFocus} keys={keys} />
        </div>
      )}
      <Input
        type="text"
        className={twMerge(
          " w-80 md:w-[25rem] my-1 text-primary-foreground placeholder:text-secondary-foreground py-2 pr-24 pl-4 rounded-md bg-primary border-[2px] hover:border-outline border-outline-secondary focus:outline-none",
          className as string,
        )}
        ref={ref}
        onFocus={handleFocus}
        {...props}
      />
    </div>
  );
}

export interface CommandPaletteItemProps extends ButtonProps {}

export function CommandPaletteItem({ children, className, ...props }: CommandPaletteItemProps) {
  return (
    <Button
      className={twMerge(
        "w-full h-12 px-2 md:px-4 rounded-md flex justify-between items-center text-base focus:outline-none focus:bg-secondary hover:bg-secondary",
        className as string,
      )}
      data-menu-item
      {...props}
    >
      {children}
    </Button>
  );
}

export interface CommandPaletteProps {
  isOpen: boolean;
  onOpenChange?: (val: boolean) => void;
  children: React.ReactNode;
  className?: string;
}

export function CommandPalette({ isOpen, onOpenChange, children, className }: CommandPaletteProps) {
  return (
    <ModalTrigger isOpen={isOpen} onOpenChange={onOpenChange}>
      <Modal className={twMerge("h-[25rem] w-80 md:w-[30rem] p-0", className as string)} isDismissable>
        {children}
      </Modal>
    </ModalTrigger>
  );
}

export interface CommandPaletteMenuProps extends GroupProps {
  children: React.ReactNode;
  isLoading?: boolean;
  isEmpty?: boolean;
}

export function CommandPaletteMenu({ children, isLoading, isEmpty, className, ...props }: CommandPaletteMenuProps) {
  const menuRef = useRef<HTMLDivElement>(null);
  const [menuItems, setMenuItems] = useState<HTMLElement[]>([]);

  
  useEffect(() => {
    if (menuRef.current) {
      const menuItemsFound = menuRef.current.querySelectorAll("[data-menu-item]") as NodeListOf<HTMLElement>;
      const arr = Array.from(menuItemsFound);

      setMenuItems(arr);
    }
  }, [children, menuRef.current]);

  function moveFocusToNextElement() {
    const currentIndex = menuItems.indexOf(document.activeElement as HTMLElement);

    if (currentIndex >= 0 && currentIndex < menuItems.length - 1) {
      menuItems[currentIndex + 1].focus();
    }

    if (currentIndex === -1) menuItems[0].focus();
  }

  function moveFocusToPreviousElement() {
    const currentIndex = menuItems.indexOf(document.activeElement as HTMLElement);

    if (currentIndex > 0 && currentIndex <= menuItems.length - 1) {
      menuItems[currentIndex - 1].focus();
    }
  }
  return (
    <Group
      className={twMerge(
        "w-full h-[calc(100%-3.25rem)] z-10 p-2 overflow-y-auto scrollbar-x scrollbar-y",
        className as string,
      )}
      ref={menuRef}
      {...props}
    >
      <KeyListener onKeyDown={moveFocusToNextElement} keys={["Down"]} />
      <KeyListener onKeyDown={moveFocusToPreviousElement} keys={["Up"]} />
      {isLoading && <CommandPaletteLoading />}
      {isEmpty && <CommandPaletteEmpty />}
      {!isLoading && !isEmpty && children}
    </Group>
  );
}

export interface CommandPaletteSearchBarProps extends InputProps {}

export function CommandPaletteSearchBar({ className, ...props }: CommandPaletteSearchBarProps) {
  function handleKeyDown(event: KeyboardEvent<HTMLInputElement>) {
    if (event.key === "ArrowDown") {
      const menuItemsFound = document.querySelectorAll("[data-menu-item]") as NodeListOf<HTMLElement>;
      const arr = Array.from(menuItemsFound);

      arr[0].focus();
      event.preventDefault();
      arr[0].scrollIntoView({
        behavior: "smooth",
        block: "nearest",
        inline: "nearest",
      });
    }
  }

  return (
    <SearchField aria-label="Search">
      <Input
        type="text"
        className={twMerge(
          "my-1 w-full bg-transparent text-foreground py-2 px-4 rounded-md border-none focus:outline-none",
          className as string,
        )}
        aria-label="Search box"
        onKeyDown={(e) => handleKeyDown(e)}
        autoFocus
        {...props}
      />
    </SearchField>
  );
}

export interface CommandPaletteGroupProps {
  children: React.ReactNode;
  heading?: string;
  className?: string;
}
export function CommandPaletteGroup({ heading, children, className }: CommandPaletteGroupProps) {
  return (
    <div className={twMerge("w-full flex flex-col", className)}>
      {heading && (
        <div>
          <h1 className="ml-2 mt-4 mb-3 text-sm font-medium underline underline-offset-1">{heading}</h1>
        </div>
      )}
      {children}
    </div>
  );
}

export function CommandPaletteLoading() {
  return (
    <div className="w-full h-full flex flex-col items-center justify-center">
      <div className="text-center text-sm font-medium text-foreground">
        <Icons.loading className="animate-spin w-8 h-8 mx-auto" />
      </div>
    </div>
  );
}

export function CommandPaletteEmpty() {
  return (
    <div className="w-full h-full flex flex-col items-center justify-center">
      <div className="text-center text-sm font-medium text-foreground">No results found</div>
    </div>
  );
}

export function CommandPaletteDivider({ className }: { className?: string }) {
  return <div className={twMerge("min-w-full border-[0.5px] border-outline", className)} />;
}

const Icons = {
  loading: (props: IconProps) => (
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" {...props}>
      <title>Loading</title>
      <path fill="currentColor" d="M12 3a9 9 0 0 1 9 9h-2a7 7 0 0 0-7-7V3Z" />
    </svg>
  ),
};

```

```react_aria|ts|example.tsx
"use client";

import {
  CommandPalette,
  CommandPaletteDivider,
  CommandPaletteGroup,
  CommandPaletteItem,
  CommandPaletteMenu,
  CommandPaletteSearchBar,
  CommandPaletteTrigger,
} from "@registry/packages/primitives/command-palette/01/react_aria-ts/CommandPalette";
import { type ChangeEvent, useState } from "react";

export default function CommandPaletteExample() {
  const [active, setActive] = useState<boolean>(false);
  const [isLoading, setIsLoading] = useState<boolean>(false);

  function simulateSearch(event: ChangeEvent<HTMLInputElement>) {
    setIsLoading(true);
    setTimeout(() => {
      setIsLoading(false);
    }, 1500);
  }

  return (
    <>
      <CommandPaletteTrigger placeholder="Search" setActive={setActive} keys={["Control", "j"]} />
      <CommandPalette isOpen={active} onOpenChange={(val) => setActive(val)}>
        <CommandPaletteSearchBar placeholder="Search for something" onChange={(e) => simulateSearch(e)} />
        <CommandPaletteDivider />
        <CommandPaletteMenu isLoading={isLoading}>
          {/* This is a sample data. You can add dynamic data here and manage the loading & empty states accordingly */}
          <CommandPaletteItem>View the components</CommandPaletteItem>
          <CommandPaletteItem>View the primitives</CommandPaletteItem>
          <CommandPaletteGroup heading="Connect">
            <CommandPaletteItem>Give us a feedback</CommandPaletteItem>
            <CommandPaletteItem>Contact the creator</CommandPaletteItem>
            <CommandPaletteItem>Talk about us on X</CommandPaletteItem>
            <CommandPaletteItem>Follow us</CommandPaletteItem>
            <CommandPaletteItem>Refer Docs</CommandPaletteItem>
          </CommandPaletteGroup>
        </CommandPaletteMenu>
      </CommandPalette>
    </>
  );
}

```

</CodeBlock>
<Details>

<Provider tag="default">
## CommandPaletteTrigger Props

| Name      | Type                                    | Default | Description                                                  |
| --------- | --------------------------------------- | ------- | ------------------------------------------------------------ |
| keys      | `Key[]`                                 | -       | Array of key combinations to activate the command palette.   |
| setActive | `Dispatch<SetStateAction<boolean>>`     | -       | Function to control the active state of the command palette. |
| className | `string`                                | -       | Additional CSS classes for custom styling.                   |
| ...props  | `InputHTMLAttributes<HTMLInputElement>` | -       | Props passed to the underlying `<input>` element.            |

## CommandPaletteItem Props

| Name      | Type                                      | Default | Description                                        |
| --------- | ----------------------------------------- | ------- | -------------------------------------------------- |
| children  | `React.ReactNode`                         | -       | The content of the command palette item.           |
| className | `string`                                  | -       | Additional CSS classes for custom styling.         |
| ...props  | `ButtonHTMLAttributes<HTMLButtonElement>` | -       | Props passed to the underlying `<button>` element. |

## CommandPalette Props

| Name         | Type                     | Default | Description                                     |
| ------------ | ------------------------ | ------- | ----------------------------------------------- |
| isOpen       | `boolean`                | -       | Controls the open state of the command palette. |
| onOpenChange | `(val: boolean) => void` | -       | Callback for when the open state changes.       |
| children     | `React.ReactNode`        | -       | The content of the command palette.             |
| className    | `string`                 | -       | Additional CSS classes for custom styling.      |

## CommandPaletteMenu Props

| Name      | Type                             | Default | Description                                       |
| --------- | -------------------------------- | ------- | ------------------------------------------------- |
| children  | `React.ReactNode`                | -       | The menu items to display in the command palette. |
| isLoading | `boolean`                        | -       | Indicates if the command palette is loading.      |
| isEmpty   | `boolean`                        | -       | Indicates if there are no results to display.     |
| className | `string`                         | -       | Additional CSS classes for custom styling.        |
| ...props  | `HTMLAttributes<HTMLDivElement>` | -       | Props passed to the underlying `<div>` element.   |

## CommandPaletteSearchBar Props

| Name      | Type                                    | Default | Description                                       |
| --------- | --------------------------------------- | ------- | ------------------------------------------------- |
| className | `string`                                | -       | Additional CSS classes for custom styling.        |
| ...props  | `InputHTMLAttributes<HTMLInputElement>` | -       | Props passed to the underlying `<input>` element. |

## CommandPaletteGroup Props

| Name      | Type              | Default | Description                                     |
| --------- | ----------------- | ------- | ----------------------------------------------- |
| heading   | `string`          | -       | Optional heading for the command palette group. |
| children  | `React.ReactNode` | -       | The content of the command palette group.       |
| className | `string`          | -       | Additional CSS classes for custom styling.      |

## CommandPaletteDivider Props

| Name      | Type     | Default | Description                                |
| --------- | -------- | ------- | ------------------------------------------ |
| className | `string` | -       | Additional CSS classes for custom styling. |

</Provider>
<Provider tag="react_aria">
## CommandPaletteTrigger Props

| Name      | Type                                | Default | Description                                                  |
| --------- | ----------------------------------- | ------- | ------------------------------------------------------------ |
| keys      | `Key[]`                             | -       | Array of key combinations to activate the command palette.   |
| setActive | `Dispatch<SetStateAction<boolean>>` | -       | Function to control the active state of the command palette. |
| className | `string`                            | -       | Additional CSS classes for custom styling.                   |
| ...props  | `InputProps`                        | -       | Props passed to the underlying `Input` component.            |

## CommandPaletteItem Props

| Name      | Type              | Default | Description                                        |
| --------- | ----------------- | ------- | -------------------------------------------------- |
| children  | `React.ReactNode` | -       | The content of the command palette item.           |
| className | `string`          | -       | Additional CSS classes for custom styling.         |
| ...props  | `ButtonProps`     | -       | Props passed to the underlying `Button` component. |

## CommandPalette Props

| Name         | Type                     | Default | Description                                     |
| ------------ | ------------------------ | ------- | ----------------------------------------------- |
| isOpen       | `boolean`                | -       | Controls the open state of the command palette. |
| onOpenChange | `(val: boolean) => void` | -       | Callback for when the open state changes.       |
| children     | `React.ReactNode`        | -       | The content of the command palette.             |
| className    | `string`                 | -       | Additional CSS classes for custom styling.      |

## CommandPaletteMenu Props

| Name      | Type              | Default | Description                                       |
| --------- | ----------------- | ------- | ------------------------------------------------- |
| children  | `React.ReactNode` | -       | The menu items to display in the command palette. |
| isLoading | `boolean`         | -       | Indicates if the command palette is loading.      |
| isEmpty   | `boolean`         | -       | Indicates if there are no results to display.     |
| className | `string`          | -       | Additional CSS classes for custom styling.        |
| ...props  | `GroupProps`      | -       | Props passed to the underlying `Group` component. |

## CommandPaletteSearchBar Props

| Name      | Type         | Default | Description                                       |
| --------- | ------------ | ------- | ------------------------------------------------- |
| className | `string`     | -       | Additional CSS classes for custom styling.        |
| ...props  | `InputProps` | -       | Props passed to the underlying `Input` component. |

## CommandPaletteGroup Props

| Name      | Type              | Default | Description                                     |
| --------- | ----------------- | ------- | ----------------------------------------------- |
| heading   | `string`          | -       | Optional heading for the command palette group. |
| children  | `React.ReactNode` | -       | The content of the command palette group.       |
| className | `string`          | -       | Additional CSS classes for custom styling.      |

## CommandPaletteDivider Props

| Name      | Type     | Default | Description                                |
| --------- | -------- | ------- | ------------------------------------------ |
| className | `string` | -       | Additional CSS classes for custom styling. |

</Provider>

</Details>
</Implementation>
</WrapperToggle>
</Wrapper>
